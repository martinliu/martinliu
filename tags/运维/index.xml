<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>运维 on Martin Liu's Blog</title><link>https://martinliu.cn/tags/%E8%BF%90%E7%BB%B4/</link><description>Recent content in 运维 on Martin Liu's Blog</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Mon, 10 Oct 2022 23:13:43 +0800</lastBuildDate><atom:link href="https://martinliu.cn/tags/%E8%BF%90%E7%BB%B4/index.xml" rel="self" type="application/rss+xml"/><item><title>SRE 实践的知识体系梳理</title><link>https://martinliu.cn/blog/sre-knowedge-body-mind-map-live-show/</link><pubDate>Mon, 10 Oct 2022 23:13:43 +0800</pubDate><guid>https://martinliu.cn/blog/sre-knowedge-body-mind-map-live-show/</guid><description>&lt;img src="https://martinliu.cn/blog/sre-knowedge-body-mind-map-live-show/1_er5uoPoOmLkfuxjTAy2zwQ.jpeg" alt="Featured image of post SRE 实践的知识体系梳理" />&lt;blockquote>
&lt;p>直播预告。在 10 月 19 日晚上，我会在社区里再次为大家梳理一下 SRE 的知识体系模型，还是用脑图的方式，向大家讲解 SRE 都有相关部分组成。&lt;/p>
&lt;/blockquote>
&lt;p>&lt;img src="https://martinliu.cn/blog/sre-knowedge-body-mind-map-live-show/poster.jpg"
width="1080"
height="1920"
srcset="https://martinliu.cn/blog/sre-knowedge-body-mind-map-live-show/poster_hu6517075e5dc9b0c2ab0e11bc34fac1ed_466978_480x0_resize_q75_box.jpg 480w, https://martinliu.cn/blog/sre-knowedge-body-mind-map-live-show/poster_hu6517075e5dc9b0c2ab0e11bc34fac1ed_466978_1024x0_resize_q75_box.jpg 1024w"
loading="lazy"
alt="活动报名海报"
class="gallery-image"
data-flex-grow="56"
data-flex-basis="135px"
>&lt;/p>
&lt;p>本次直播活动的录播视频。&lt;/p>
&lt;div class="video-wrapper">
&lt;iframe src="https://player.bilibili.com/player.html?as_wide=1&amp;amp;high_quality=1&amp;amp;page=1&amp;bvid=BV1XD4y1r7dS"
scrolling="no"
frameborder="no"
framespacing="0"
allowfullscreen="true"
>
&lt;/iframe>
&lt;/div>
&lt;p>下面这幅脑图是在我翻译完了《SRE Workbook》之后编写的，用了我好几天的时间，并且前后改了好几版。&lt;/p>
&lt;p>编制这个脑图的出发点在于：SRE 从来源到 5 大基础模块，到推广实施的方法论都看似比较完整，比较成体系。这种脉络明晰的知识体系（knowledge body）本来就有画出脑图的可能性；而且脑图应该是一种比较便于吸收和学习的形式。&lt;/p>
&lt;p>脑图的第一个版本是从 《SRE Workbook》的目录开始的，我尝试用最精简的方式，梳理每一章节中的知识点。可是在编制了前两章以后，就发现这个工作量其实非常的大。然后，我果断的放弃了“完美”的目标，然后将目标定位为：先完成一版。下图就是这样一个版本。后续我们讨论还有那些改进和与社区协作的想法。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/sre-knowedge-body-mind-map-live-show/SRE-Workbookv1.5.jpg"
width="1921"
height="15987"
srcset="https://martinliu.cn/blog/sre-knowedge-body-mind-map-live-show/SRE-Workbookv1.5_huf0f9a85bb1809319b815bf2ddc711170_1940634_480x0_resize_q75_box.jpg 480w, https://martinliu.cn/blog/sre-knowedge-body-mind-map-live-show/SRE-Workbookv1.5_huf0f9a85bb1809319b815bf2ddc711170_1940634_1024x0_resize_q75_box.jpg 1024w"
loading="lazy"
alt="SRE 知识体系脑图"
class="gallery-image"
data-flex-grow="12"
data-flex-basis="28px"
>&lt;/p>
&lt;p>后续的未尽事项：&lt;/p>
&lt;ul>
&lt;li>细化现有版本，将《SRE Workbook》中的知识点尽量都涵盖尽量。&lt;/li>
&lt;li>将 SRE 的第一本出版物《Google SRE 运维解密》也梳理进来，由于它已经被 Workbook 彻底包含，并且多次引用。&lt;/li>
&lt;li>将 SRE 安全那本书也梳理进来，由于安全的特殊性，独立做一个节点梳理比较现实；如果能融入的更好，则更加。&lt;/li>
&lt;li>需要找到一种方便人们协作的线上脑图协作软件，应该至少具备一下功能：
&lt;ul>
&lt;li>多人协作&lt;/li>
&lt;li>评论知识点&lt;/li>
&lt;li>支持导入导出标准格式的脑图文件&lt;/li>
&lt;li>支持导入导出 pdf，png，jpg ，html 等方便人们引用的文档&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>欢迎范围和参考 Google 官方 SRE 独立站点。https://sre.google/&lt;/p>
&lt;p>网站中的相关出版书籍如下。&lt;/p>
&lt;h2 id="site-reliability-engineering">Site Reliability Engineering&lt;/h2>
&lt;p>&lt;img src="https://martinliu.cn/blog/sre-knowedge-body-mind-map-live-show/sre1.jpg"
width="400"
height="512"
srcset="https://martinliu.cn/blog/sre-knowedge-body-mind-map-live-show/sre1_hu53835effa6f9d1306cd24ea0f0435d4a_134656_480x0_resize_q75_box.jpg 480w, https://martinliu.cn/blog/sre-knowedge-body-mind-map-live-show/sre1_hu53835effa6f9d1306cd24ea0f0435d4a_134656_1024x0_resize_q75_box.jpg 1024w"
loading="lazy"
alt="sre book 1"
class="gallery-image"
data-flex-grow="78"
data-flex-basis="187px"
>&lt;/p>
&lt;ul>
&lt;li>中文版书名：&lt;a class="link" href="https://book.douban.com/subject/26875239//" target="_blank" rel="noopener"
>SRE：Google运维解密&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://sre.google/sre-book/table-of-contents/" target="_blank" rel="noopener"
>英文版线上阅读&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="the-site-reliability-workbook">The Site Reliability Workbook&lt;/h2>
&lt;p>&lt;img src="https://martinliu.cn/blog/sre-knowedge-body-mind-map-live-show/sre2.jpg"
width="399"
height="512"
srcset="https://martinliu.cn/blog/sre-knowedge-body-mind-map-live-show/sre2_hu86e42e7f2523b776da22047c5be51759_67632_480x0_resize_q75_box.jpg 480w, https://martinliu.cn/blog/sre-knowedge-body-mind-map-live-show/sre2_hu86e42e7f2523b776da22047c5be51759_67632_1024x0_resize_q75_box.jpg 1024w"
loading="lazy"
alt="sre book 2"
class="gallery-image"
data-flex-grow="77"
data-flex-basis="187px"
>&lt;/p>
&lt;ul>
&lt;li>中文版书名：&lt;a class="link" href="https://book.douban.com/subject/35224058/" target="_blank" rel="noopener"
>Google SRE 工作手册&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://sre.google/sre-book/table-of-contents/" target="_blank" rel="noopener"
>英文版线上阅读&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="building-secure--reliable-systems">Building Secure &amp;amp; Reliable Systems&lt;/h2>
&lt;p>&lt;img src="https://martinliu.cn/blog/sre-knowedge-body-mind-map-live-show/sre3.jpg"
width="399"
height="512"
srcset="https://martinliu.cn/blog/sre-knowedge-body-mind-map-live-show/sre3_hud32f4122fb66ecf5dafbe90e60b5874f_53729_480x0_resize_q75_box.jpg 480w, https://martinliu.cn/blog/sre-knowedge-body-mind-map-live-show/sre3_hud32f4122fb66ecf5dafbe90e60b5874f_53729_1024x0_resize_q75_box.jpg 1024w"
loading="lazy"
alt="sre book 3"
class="gallery-image"
data-flex-grow="77"
data-flex-basis="187px"
>&lt;/p>
&lt;ul>
&lt;li>中文书名：&lt;a class="link" href="https://book.douban.com/subject/35585206/" target="_blank" rel="noopener"
>《Google系统架构解密》&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://sre.google/static/pdf/building_secure_and_reliable_systems.pdf" target="_blank" rel="noopener"
>英文版 PDF 版 官方免费下载&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>删除Cisco交换机中的所有VLAN数据</title><link>https://martinliu.cn/blog/%E5%88%A0%E9%99%A4cisco%E4%BA%A4%E6%8D%A2%E6%9C%BA%E4%B8%AD%E7%9A%84%E6%89%80%E6%9C%89vlan%E6%95%B0%E6%8D%AE/</link><pubDate>Tue, 09 Nov 2021 12:58:16 +0800</pubDate><guid>https://martinliu.cn/blog/%E5%88%A0%E9%99%A4cisco%E4%BA%A4%E6%8D%A2%E6%9C%BA%E4%B8%AD%E7%9A%84%E6%89%80%E6%9C%89vlan%E6%95%B0%E6%8D%AE/</guid><description>&lt;img src="https://elasticstack-1300734579.cos.ap-nanjing.myqcloud.com/2021-11-09-bigstock-network-hub-and-patch-cables-12234593-1.jpeg" alt="Featured image of post 删除Cisco交换机中的所有VLAN数据" />&lt;p>最近在闲鱼上收了几台网络设备，其中有一台Cisco 3560X作为lab的核心交换机，其它一些都是用于练习网络运维。本文从清除老旧设备上的vlan开始，将会记录我在这些网络设备上的所有重要配置操作。&lt;/p>
&lt;h2 id="网络设备的初始化">网络设备的初始化&lt;/h2>
&lt;h3 id="cisco-交换机">Cisco 交换机&lt;/h3>
&lt;p>Cisco 3560 的初始化是非常容易和方便的，这是一台非常新的设备，拆机后，机箱内部都没有什么积累明显的灰尘。第一次开机的时候通过mini USB口的连线连接，登陆console后发现需要密码才能进入enable模式，然后不得不重置这个设备的所有配置。&lt;/p>
&lt;ul>
&lt;li>在交换机开机的情况下，先用mini USB连接好电脑和交换机。&lt;/li>
&lt;li>拔掉交换机的电源线&lt;/li>
&lt;li>按住交换机前面板，左上角的mode按钮不放&lt;/li>
&lt;li>插上交换机电源线&lt;/li>
&lt;li>保持mode按钮10+秒以上&lt;/li>
&lt;li>看着交换机正常启动，并且进入了快速配置模式&lt;/li>
&lt;li>选择进入快速配置模式，或者选择no，进入正常无向导的手工配置模式&lt;/li>
&lt;/ul>
&lt;p>到此处为止，你就进入了一个无密码，几乎无配置的状态。虽然现在这是一台几乎空白配置的交换机。但是交换机的文件系统里还是有一个名为vlan.dat的数据文件。这个文件是之前这个交换机的管理员留下的。有了他的存在当你当你执行 ‘ show vlan brief ’ 命令的时候，这个数据文件中的vlan数据有近百行，滚动了半天，非常烦人。因此需要想办法将其删除。&lt;/p>
&lt;h4 id="清除vlan数据文件">清除VLAN数据文件&lt;/h4>
&lt;p>参考文章：https://www.networkstraining.com/deleting-the-vlan-database-from-a-cisco-switch/&lt;/p>
&lt;p>首先查看flash上有哪些文件，使用命令 &lt;code>show flash&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sw-bj-01#show flash:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Directory of flash:/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 10 -rwx 4371 Jan 2 2006 23:55:34 +00:00 config.text
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2 -rwx 26945536 Aug 31 2018 10:01:56 +00:00 c3560e-universalk9-mz.152-4.E6.bin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 3 -rwx 26844160 Feb 28 2019 05:02:21 +00:00 c3560e-universalk9-mz.152-4.E7.bin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 4 -rwx 0 Mar 27 2019 18:36:06 +00:00 merge_config.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 5 -rwx 6168 Jan 2 2006 23:55:34 +00:00 multiple-fs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 6 -rwx 2915 Jan 2 2006 00:02:10 +00:00 config.old
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 8 -rwx 27468 Mar 27 2019 18:36:05 +00:00 candidate_config.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 9 -rwx 736 Jan 2 2006 00:08:27 +00:00 vlan.dat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 11 -rwx 3835 Jan 2 2006 23:55:34 +00:00 private-config.text
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">57671680 bytes total (3395584 bytes free)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>上面的命令结果中的倒数第二行就是用来保存vlan信息的文件。然后我们使用 &lt;code>delete vlan.dat&lt;/code> 命令将其删除即可。然后使用 &lt;code>copy running-config startup-config&lt;/code> 保存当前的战果。还可以使用 reload 重启一下交换机，再次登陆交换机之后使用 show vlan brief 命令校验当前的交换机上只有默认的6个vlan存在。&lt;/p>
&lt;h4 id="启用-ssh-和-web-登陆">启用 ssh 和 web 登陆&lt;/h4>
&lt;p>每次都适用console线连接并配置交换机？这样还是有点麻烦的，我们需要启用交换机的管理ip和ssh登陆这样以后就可以从网络配置了。以后就可以用Ansible之类的DevOps工具玩NetOps了。配置过程的主要命令如下：&lt;/p>
&lt;ol>
&lt;li>配置管理ip， 参考命令如下：&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># ip default-gateway 192.168.101.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># interface vlan 101
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">(config-if)# ip address 192.168.101.2 255.255.255.0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="2">
&lt;li>主机名， 参考命令如下：&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># config t
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">(config)# hostname myswitch
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">(config)# ip domain-name thegeekstuff.com
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="3">
&lt;li>创建 RSA 密钥，用于启用ssh登陆，参考命令如下&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">myswitch(config)# crypto key generate rsa
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> The name for the keys will be: myswitch.thegeekstuff.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Choose the size of the key modulus in the range of 360 to 2048 for your
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> General Purpose Keys. Choosing a key modulus greater than 512 may take
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> a few minutes.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">How many bits in the modulus [512]: 1024
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> % Generating 1024 bit RSA keys, keys will be non-exportable...[OK]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="4">
&lt;li>配置一些 Line VTY 和 console 的参数&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># line vty 0 4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">(config-line)# transport input ssh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">(config-line)# login local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">(config-line)# password mypassword
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">(config-line)# exit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># line console 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">(config-line)# logging synchronous
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">(config-line)# login local
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="5">
&lt;li>设置用户名和密码&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">myswitch# config t
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Enter configuration commands, one per line. End with CNTL/Z.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">myswitch(config)# username myusername password mypassword
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>如果你还没有配置enable的密码可以参考下面的命令。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">myswitch# enable secret myenablepassword
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">myswitch# service password-encryption
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="6">
&lt;li>校验 ssh 访问&lt;/li>
&lt;/ol>
&lt;p>使用命令如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">myswitch# sh ip ssh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SSH Enabled - version 1.99
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Authentication timeout: 120 secs; Authentication retries: 3
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>现在你可以用网络上的电脑测试ssh登陆这个交换机的ip了。&lt;/p>
&lt;h3 id="cisco-路由器">Cisco 路由器&lt;/h3>
&lt;p>待完成&lt;/p>
&lt;h3 id="cisco-防火墙">Cisco 防火墙&lt;/h3>
&lt;p>待完成&lt;/p>
&lt;p>&amp;mdash;- 未完待续 &amp;mdash;-&lt;/p></description></item><item><title>腾讯云下部署 Elastic Stack 各种 Beat 的最佳实践</title><link>https://martinliu.cn/blog/%E8%85%BE%E8%AE%AF%E4%BA%91%E4%B8%8B%E9%83%A8%E7%BD%B2-elastic-stack-%E5%90%84%E7%A7%8D-beat-%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/</link><pubDate>Fri, 07 Aug 2020 17:14:20 +0800</pubDate><guid>https://martinliu.cn/blog/%E8%85%BE%E8%AE%AF%E4%BA%91%E4%B8%8B%E9%83%A8%E7%BD%B2-elastic-stack-%E5%90%84%E7%A7%8D-beat-%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/</guid><description>&lt;img src="https://martinliu.cn/images/abstract-6.jpg" alt="Featured image of post 腾讯云下部署 Elastic Stack 各种 Beat 的最佳实践" />&lt;h2 id="概述">概述&lt;/h2>
&lt;p>使用 Elastic Stack 的各种 Beats 模块可以彻底的终结在服务器上手工捞日志查指标的扭曲实践。利用腾讯云提供的 Elasticsearch 服务，可以轻松搞定大规模云环境的运维。本文一次性的帮你梳理清楚了，必备的基础操作，确保你能用 Elastic Stack 安全、稳定和扩展的持续监控你的生产环境。&lt;/p>
&lt;h2 id="创建-es-集群">创建 ES 集群&lt;/h2>
&lt;p>登录腾讯云服务控制台，查询并进入 Elasticsearc 服务，点击新建按钮，创建 Elasticsearch 集群。如下图所示。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/qcloud-es.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>集群配置说明：&lt;/p>
&lt;ul>
&lt;li>北京区&lt;/li>
&lt;li>7.5.1 - 白金版&lt;/li>
&lt;li>单可用区&lt;/li>
&lt;li>冷热模式&lt;/li>
&lt;/ul>
&lt;p>本实例其它参数保持默认，可以根据实际业务需求修改这些参数。&lt;/p>
&lt;p>点击下一步后，设置 Elasticsearch 集群的超级用户名和密码。&lt;/p>
&lt;p>在几分钟之后这个集群就成功创建了。查看下面这些基础的配置。&lt;/p>
&lt;ul>
&lt;li>启用 Kibana 内网地址： &lt;a class="link" href="http://es-ot7wei87.internal.kibana.tencentelasticsearch.com:5601" target="_blank" rel="noopener"
>http://es-ot7wei87.internal.kibana.tencentelasticsearch.com:5601&lt;/a> 用于 Bests 的 Setup 命令&lt;/li>
&lt;li>启用 Kibana 公网地址： &lt;a class="link" href="https://es-ot7wei87.kibana.tencentelasticsearch.com:5601" target="_blank" rel="noopener"
>https://es-ot7wei87.kibana.tencentelasticsearch.com:5601&lt;/a> 用户Elastic Stack 的初始化配置，如创建角色和调整索引生命周期策略等。&lt;/li>
&lt;/ul>
&lt;p>这样我们就有了一个安全、可扩展和性能足够的 ES 后台服务。&lt;/p>
&lt;h2 id="创建-beats-写入角色和用户">创建 Beats 写入角色和用户&lt;/h2>
&lt;p>登录 Kibana ，点击角色和用户管理，创建用于 Beast 配置文件的‘只写’权限用户。&lt;/p>
&lt;ul>
&lt;li>创建 beats-writer 角色&lt;/li>
&lt;li>创建 beats-writer 用户，该用户只赋予beats-writer角色，自定义一个安全的复杂密码。&lt;/li>
&lt;/ul>
&lt;p>Beats-write 角色设置如下图所示：&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/beats-writer.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>这个用户会用到后面的所有 Beats 配置文件中，用最小化权限用户极大的降低了数据泄露的风险。&lt;/p>
&lt;h2 id="beats-初始化配置">Beats 初始化配置&lt;/h2>
&lt;p>登录准备好的一个 Linux 服务器，在这台机器上做 Beats 相关的初始化工作；也就是要执行一些列的 setup 命令；这些命令的作用是：&lt;/p>
&lt;ul>
&lt;li>在 ES 后台加载索引模板，以及索引的 ILM 策略。&lt;/li>
&lt;li>加载 Kibana 相关的对象和可视化仪表板。&lt;/li>
&lt;/ul>
&lt;p>注意这是一次性的工作，在一个虚拟机上，只需要成功执行一次。&lt;/p>
&lt;p>SSH 登录到准备的 Linux 服务器上，首先需要安装相关 beats 的 rpm 安装包，安装命令在这里忽略，否则无法执行这些命令。 安装好 filebeat 和 metricbeat 的rpm 包后， 执行下面参考命令。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">filebeat setup -e &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -E output.logstash.enabled&lt;span class="o">=&lt;/span>&lt;span class="nb">false&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -E output.elasticsearch.hosts&lt;span class="o">=[&lt;/span>&lt;span class="s1">&amp;#39;192.168.0.43:9200&amp;#39;&lt;/span>&lt;span class="o">]&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -E output.elasticsearch.username&lt;span class="o">=&lt;/span>elastic &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -E output.elasticsearch.password&lt;span class="o">=&lt;/span>YourPassWord &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -E setup.kibana.host&lt;span class="o">=&lt;/span>es-ot7wei87.internal.kibana.tencentelasticsearch.com:5601
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metricbeat setup -e &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -E output.elasticsearch.hosts&lt;span class="o">=[&lt;/span>&lt;span class="s1">&amp;#39;192.168.0.43:9200&amp;#39;&lt;/span>&lt;span class="o">]&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -E output.elasticsearch.username&lt;span class="o">=&lt;/span>elastic &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -E output.elasticsearch.password&lt;span class="o">=&lt;/span>YourPassWord &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -E setup.kibana.host&lt;span class="o">=&lt;/span>es-ot7wei87.internal.kibana.tencentelasticsearch.com:5601
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>运行以上命令的时候 Beats 处于默认安装的状态，这些命令行参数是必要的查收，有了这些参数 beats 会忽略默认的配置文件。&lt;/p>
&lt;p>以上命令根据需求，如果需要使用到其它的 Beats，请使用相关的 setup 命令。其中的 es 和 kibana 相关信息需求参考上一步创建的 es 集群信息。&lt;/p>
&lt;p>以上所有命令成功之后，登录 Kibana 界面，点击 Dashboard 菜单，这里应该已经加载了很多仪表板。目前为止 Elastic Stack 后台就初始化成功了。&lt;/p>
&lt;h2 id="在节点上正式部署-beats">在节点上正式部署 Beats&lt;/h2>
&lt;p>参考和修改安装脚本，一键式安装和配置 Beats&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">git clone https://github.com/martinliu/elastic-stack-lab.git
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cd tencent
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sh add-agent.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>成功执行完以上脚本后，相关的 beats 服务应是正常运行的状态。执行完这个命令之后，在 Linux 服务器上使用检查服务是否正常运行 &lt;code>sudo systemctl status filebeat&lt;/code> ；使用这个命令应该可以看到filebeat 服务都是正常运行的。&lt;/p>
&lt;p>这个脚本所使用的配置文件中的要点：&lt;/p>
&lt;ul>
&lt;li>删除了所有和数据摄入无关的配置（例如 es 和 kibana 的配置和初始化等）&lt;/li>
&lt;li>加入了最小化的必要的最佳实践参数集合&lt;/li>
&lt;li>建议根据需求增加 beats 相关的模块&lt;/li>
&lt;li>根据需求加入必要的 Beat 配置参数&lt;/li>
&lt;/ul>
&lt;p>实例配置文件如。&lt;/p>
&lt;p>filebeat.yml&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#=========================== Filebeat inputs =============================
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">filebeat.inputs:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- type: log
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> enabled: false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> paths:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - /var/log/*.log
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#============================= Filebeat modules ===============================
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">filebeat.config.modules:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> path: ${path.config}/modules.d/*.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> reload.enabled: true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> reload.period: 60s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#-------------------------- Elasticsearch output ------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">output.elasticsearch:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hosts: [&amp;#34;${INT_ES_SRV}&amp;#34;]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> password: ${BEATS_WRITER_PW}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> username: ${BEATS_WRITER_USERNAME}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#================================ Processors =====================================
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">processors:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - add_host_metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> netinfo.enabled: true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> cache.ttl: 5m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - add_cloud_metadata: ~
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - add_docker_metadata: ~
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - add_kubernetes_metadata: ~
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - add_fields:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> target: &amp;#39;&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> fields:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> service.name: &amp;#39;Joint Lab&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> service.id: &amp;#39;es-qq&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#==================== Best Practice Configuration ==========================
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">setup.ilm.check_exists: false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">logging.level: error
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">queue.spool: ~
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">monitoring:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> enabled: true
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>metricbeat.yml&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># =========================== Modules configuration ============================
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metricbeat.config.modules:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> path: ${path.config}/modules.d/*.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> reload.enabled: true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> reload.period: 10s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#-------------------------- Elasticsearch output ------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">output.elasticsearch:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hosts: [&amp;#34;${INT_ES_SRV}&amp;#34;]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> password: ${BEATS_WRITER_PW}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> username: ${BEATS_WRITER_USERNAME}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#================================ Processors =====================================
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">processors:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - add_host_metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> netinfo.enabled: true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> cache.ttl: 5m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - add_cloud_metadata: ~
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - add_docker_metadata: ~
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - add_kubernetes_metadata: ~
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - add_fields:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> target: &amp;#39;&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> fields:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> service.name: &amp;#39;Joint Lab&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> service.id: &amp;#39;es-qq&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#==================== Best Practice Configuration ==========================
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">setup.ilm.check_exists: false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">logging.level: error
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">queue.spool: ~
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">monitoring:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> enabled: true
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>以上配置文件使用了这些通用最佳实践配置参数。&lt;/p>
&lt;ul>
&lt;li>使用 ECS 扩展字段，丰富上下文含义&lt;/li>
&lt;li>启用 beats 端点监控&lt;/li>
&lt;li>用 keystore 隐藏所有敏感信息&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#禁用索引 ilm 策略检查，避免无用动作
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">setup.ilm.check_exists: false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#把Beats自身的日志记录调到最低级别降低
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">logging.level: error
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#开启本地默认的端点缓存行为
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">queue.spool: ~
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#启用端点的监控
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">monitoring:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> enabled: true
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="排错方法">排错方法&lt;/h2>
&lt;h3 id="filebeat-setup-不成功">filebeat setup 不成功&lt;/h3>
&lt;p>在任何 beats 首次做 setup 命令的时候，它可能是会在分钟级别成功结束。如果发生失败或者卡顿的情况，可以等一下，等更长时间看看。不成功的话，需要反复执行，排查 es 和 kibana 服务是否能正常工作。知道陈功了，才能进行下一步的安装工作。&lt;/p>
&lt;h3 id="配置文件错误导致的服务不能启动">配置文件错误导致的服务不能启动&lt;/h3>
&lt;p>由于上面的定制化配置文件也可能出现错误，特别是在首次部署这个配置文件的时候，可以先把日志级别 error 哪一行注释掉，把启动服务那两行也注释掉。&lt;/p>
&lt;p>然后在命令行执行 &lt;code>filebeat -e&lt;/code> 查看整个 feilebeat 的启动过程，这个命令会读取定制化的配置文件，然后开始连接后台 es 服务，然后进入正常数据传送的状态。这个过程中如果有任何配置错误，也可以直观的看到相关信息，直到调整到正常的状态。&lt;/p>
&lt;p>以上过程的调整好了以后，一定要通过 git 版本管理起来，然后可以放心的在其它节点上执行 beast 的一键式部署工作。&lt;/p>
&lt;h2 id="总结">总结&lt;/h2>
&lt;p>以上是在 Beats 部署相关基础最佳实践，也就是说在生产环境中 ES 后台和 beats 的搭配，以及本文所涉及的内容都是基线配置。建议根据自己的需求做更多的调优，这里使用 shell 脚本的方式部署 beats 和相关的配置，shell 脚本适合用于演示原理，建议替换成你所熟悉的自动化运维工具，例如 ansible 等工具。从而保证更大规模的自动化部署和维护。&lt;/p>
&lt;p>本相关的配置文件和脚本位于：https://github.com/martinliu/elastic-stack-lab.git&lt;/p></description></item></channel></rss>